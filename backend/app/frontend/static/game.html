<!doctype html>
<html lang="en">
<!-- Head section with meta tags and stylesheets -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hangman â€” Game</title>
  <link rel="stylesheet" href="./css/layout.css" />
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#2563eb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('./sw.js');
      });
    }
  </script>
</head>
<!-- Body section with the main app structure -->
<body>
  <div class="app-shell theme-light" id="app">
      <!-- Header with branding and controls -->
    <div class="header">
      <div class="brand">
        <div class="logo">H</div>
        <div>
          <h1>Hangman</h1>
          <div style="font-size:12px;color:var(--muted)">Play the game</div>
        </div>
      </div>

        <!-- Control buttons: Theme toggle and New Game -->
      <div class="controls">
        <button id="toggleTheme" class="btn secondary" type="button" aria-label="Toggle theme"></button>
        <button id="newGameBtn" class="btn">Start New Game</button>
      </div>
    </div>

      <!-- Main game grid layout -->
    <div class="game-grid margin-top">
        <!-- Gallows and hangman figure -->
      <div class="gallows-column">
        <div class="gallows stage-0" id="gallows">
          <div class="gallow-base part"></div>
          <div class="gallow-post part"></div>
          <div class="gallow-beam part"></div>
          <div class="gallow-support part"></div>
          <div class="gallow-rope part"></div>

          <div class="head part"></div>
          <div class="body part"></div>
          <div class="arm-left part"></div>
          <div class="arm-right part"></div>
          <div class="leg-left part"></div>
          <div class="leg-right part"></div>
        </div>
      </div>

      <div>
          <!-- Game card with HUD, word box, keyboard, and controls -->
        <div class="card">
          <div class="hud">
            <div class="stat">Score: <strong id="score">0</strong></div>
            <div class="stat">Attempts left: <strong id="attempts">0</strong></div>
            <div class="stat hint-badge">Hints: <span id="hints">0</span></div>
          </div>

            <!-- Controls row -->
          <div class="controls-row" style="margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
          </div>

            <!-- Word box for displaying letter slots -->
          <div class="word-box" id="wordBox" style="margin-top:18px">
            <!-- letter slots will be rendered here -->
          </div>

          <!-- Word metadata (clue/topic); hidden when not available -->
          <div id="wordMeta" class="word-meta" style="display:none;margin-top:12px;padding:10px;border-radius:10px;background:var(--glass);">
            <div id="wordClue" style="font-weight:700;color:var(--accent);">Clue: </div>
            <div id="wordTopic" style="font-size:13px;color:var(--muted);margin-top:6px">Topic: </div>
          </div>

            <!-- On-screen keyboard for letter selection -->
          <div class="keyboard" id="keyboard" style="margin-top:18px">
            <!-- alphabet buttons injected -->
          </div>

            <!-- Hint button -->
          <div style="margin-top:14px;display:flex;gap:8px;justify-content:center;align-items:center">
            <button class="btn" id="hintBtn">Use Hint</button>
          </div>
        </div>

          <!-- Footer section -->
        <div class="footer" style="margin-top:12px">
          <div>Good luck!</div>
          <div>Version 0.1</div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript files -->
  <script src="./javascript/theme.js"></script>
  <script>
    // Authentication check - redirect if no token found
    (function(){
      'use strict';
      try{
        // check for access token in localStorage
        const token = localStorage.getItem('access_token');
        if(!token){
          // build a centered notice with a 5s countdown and accessible buttons
          const notice = document.createElement('div');
          notice.id = 'authRedirectNotice';
          notice.setAttribute('role','alertdialog');
          notice.setAttribute('aria-live','assertive');
          notice.style.cssText = 'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);z-index:9999;padding:16px';

          notice.innerHTML = `
            <div style="width:100%;max-width:480px;background:var(--card-bg,#fff);color:var(--text,#111);padding:18px;border-radius:12px;box-shadow:var(--shadow);text-align:center">
              <p style="margin:0 0 8px;font-size:18px;font-weight:700">You're not signed in</p>
              <p id="authNoticeMsg" style="margin:0 0 12px;color:var(--muted)">You'll be redirected to the homepage in <span id="redirectCountdown">5</span> seconds.</p>
              <div style="display:flex;gap:8px;justify-content:center;margin-top:6px">
                <button id="redirectNow" class="btn" type="button">Go now</button>
                <button id="redirectLogin" class="btn secondary" type="button">Go to Login</button>
              </div>
            </div>
          `;

          // append to body
          document.body.appendChild(notice);

          // Start countdown
          let secs = 5;
          const el = document.getElementById('redirectCountdown');
          const tick = () => {
            secs -= 1;
            if(el) el.textContent = String(secs);
            if(secs <= 0){
              clearInterval(timer);
              // final redirect to index
              window.location.href = '/frontend/static/index.html';
            }
          };
          // initial tick
          const timer = setInterval(tick, 1000);

          // Button handlers
          const safeRemove = ()=>{ try{ const n = document.getElementById('authRedirectNotice'); if(n) n.remove(); }catch(e){}
          };
          // Redirect now button
          document.getElementById('redirectNow').addEventListener('click', ()=>{
            clearInterval(timer); window.location.href = '/frontend/static/index.html';
          });
          // Redirect to login button
          document.getElementById('redirectLogin').addEventListener('click', ()=>{
            clearInterval(timer); window.location.href = '/frontend/static/login.html';
          });
        }
      }catch(e){
        // don't block page if DOM/storage access fails
        console.error('auth check failed', e);
      }
    })();
  </script>
  <!-- Main game logic script -->
  <script src="./javascript/game.js"></script>

  <!-- Resume modal (hidden by default) -->
  <div id="resumeModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="resumeModalTitle">
    <div class="modal-backdrop" data-dismiss="modal"></div>
    <div class="modal-panel" role="document">
      <header class="modal-header">
        <h2 id="resumeModalTitle">Resume previous game?</h2>
      </header>
      <div class="modal-body">
        <p id="resumeModalMessage">You have an unfinished game. Would you like to resume it?</p>
      </div>
      <footer class="modal-footer">
        <button id="resumeModalResume" class="btn">Resume</button>
        <button id="resumeModalCancel" class="btn secondary">Cancel</button>
      </footer>
    </div>
  </div>

  <!-- New Game Modal -->
  <div id="newGameModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="newGameModalTitle">
    <div class="modal-backdrop" data-dismiss="modal"></div>
    <div class="modal-panel" role="document">
      <header class="modal-header">
        <h2 id="newGameModalTitle">Choose a difficulty</h2>
      </header>
      <div class="modal-body" id="newGameDifficultyButtons" style="display: flex; flex-direction: column; gap: 10px; padding: 10px 0;">
        <button class="btn" data-difficulty="easy">Easy</button>
        <button class="btn" data-difficulty="medium">Medium</button>
        <button class="btn" data-difficulty="hard">Hard</button>
        <button class="btn" data-difficulty="insane">Insane</button>
      </div>
      <footer class="modal-footer">
        <button id="newGameCancel" class="btn secondary">Cancel</button>
      </footer>
    </div>
  </div>

  <!-- Confirm New Game Modal -->
  <div id="confirmNewGameModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="confirmNewGameModalTitle">
    <div class="modal-backdrop" data-dismiss="modal"></div>
    <div class="modal-panel" role="document">
      <header class="modal-header">
        <h2 id="confirmNewGameModalTitle">Start a new game?</h2>
      </header>
      <div class="modal-body">
        <p>You haven't finished the current game. Would you like to cancel it and start a new one?</p>
      </div>
      <footer class="modal-footer">
        <button id="confirmNewGameYes" class="btn">Yes</button>
        <button id="confirmNewGameNo" class="btn secondary">No</button>
      </footer>
    </div>
  </div>

  <!-- Generic Message Modal -->
  <div id="messageModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="messageModalTitle">
    <div class="modal-backdrop"></div>
    <div class="modal-panel" role="document">
      <header class="modal-header">
        <h2 id="messageModalTitle">Notification</h2>
      </header>
      <div class="modal-body">
        <p id="messageModalText"></p>
      </div>
      <footer class="modal-footer">
        <button id="messageModalOk" class="btn">OK</button>
      </footer>
    </div>
  </div>
</body>
</html>
